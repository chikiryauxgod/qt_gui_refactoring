commit 0f36aa38ffbb857a530120ba3813a8d99da88b83
Author:     lewace37 <lewace37@yandex.ru>
AuthorDate: Wed Jan 21 19:33:02 2026 +0500
Commit:     lewace37 <lewace37@yandex.ru>
CommitDate: Wed Jan 21 19:33:02 2026 +0500

    feat: add plotters


FILES:

FILE: src/qt_interface.py
LANG: py

index 9889b09..162ac2f 100644
--- a/src/qt_interface.py
+++ b/src/qt_interface.py
@@ -40,6 +40,11 @@ from src.VideoStream.VideoStreamThread import VideoStreamThread
 from src.presenters.joint_control_presenter import JointControlPresenter
 from src.domain.xyz_availability_service import XYZAvailabilityService
 from src.domain.joint_availability_service import JointAvailabilityService
+from src.visualization.xyz_kinematics_plotter import XYZKinematicsPlotter
+from src.visualization.xyz_trajectory_plotter import XYZTrajectoryPlotter
+from src.visualization.joints_trajectory_plotter import JointsTrajectoryPlotter
+
+
 
 
 
@@ -962,6 +967,7 @@ class ServiceTab(QWidget):
         self.xyz_presenter = XYZControlPresenter(controller)
         self.trajectory_service = XYZTrajectoryService()
         self.trajectory_points_joints = JointTrajectoryService()
+        
         self.xyz_trajectory_executor = XYZTrajectoryExecutor(
             controller=self.controller,
             trajectory_service=self.trajectory_service,)
@@ -970,8 +976,7 @@ class ServiceTab(QWidget):
             joint_presenter=self.joint_presenter,
             trajectory_service=self.trajectory_points_joints,)
         self.xyz_availability_service = XYZAvailabilityService()
-        self.joint_availability_service = JointAvailabilityService()
-
+        self.joint_availability_service = JointAvailabilityService()    
         
         self.continuous_move_timer = QTimer()
         self.continuous_move_timer.timeout.connect(self.continuous_move)
@@ -1155,6 +1160,12 @@ class ServiceTab(QWidget):
         self.xyz_canvas = FigureCanvas(self.xyz_fig)
         vis_layout.addWidget(self.xyz_canvas)
         
+        self.xyz_kinematics_plotter = XYZKinematicsPlotter(
+            ax=self.xyz_ax,
+            canvas=self.xyz_canvas,
+            robot_chain=self.robot_chain,
+            ikpy_available=IKPY_AVAILABLE,)
+        
         update_btn = QPushButton("Обновить визуализацию")
         update_btn.clicked.connect(self.update_xyz_plot)
         vis_layout.addWidget(update_btn)
@@ -1369,6 +1380,9 @@ class ServiceTab(QWidget):
         self.joints_canvas.setMinimumSize(400, 350)  # Фиксируем минимальный размер
         vis_layout.addWidget(self.joints_canvas)
         
+        self.joints_trajectory_plotter = JointsTrajectoryPlotter(
+            self.joints_ax, self.joints_canvas)
+        
         update_btn = QPushButton("Обновить визуализацию")
         update_btn.clicked.connect(self.update_joints_plot)
         vis_layout.addWidget(update_btn)
@@ -1539,6 +1553,10 @@ class ServiceTab(QWidget):
         self.xyz_traj_canvas = FigureCanvas(self.xyz_traj_fig)
         vis_layout.addWidget(self.xyz_traj_canvas)
         
+        self.xyz_trajectory_plotter = XYZTrajectoryPlotter(
+            ax=self.xyz_traj_ax,
+            canvas=self.xyz_traj_canvas,)
+        
         vis_frame.setLayout(vis_layout)
         layout.addWidget(vis_frame)
         
@@ -1707,57 +1725,12 @@ class ServiceTab(QWidget):
 
     @Slot()
     def update_xyz_plot(self):
-            """Обновление графика с кинематической цепочкой для осей XYZ"""
-            self.xyz_ax.clear()
-            
-            x, y, z = self.controller.current_x, self.controller.current_y, self.controller.current_z
-            
-            # Отображаем кинематическую цепочку, если доступна
-            if self.robot_chain and IKPY_AVAILABLE:
-                try:
-                    # Преобразуем координаты в метры для ikpy (из мм в метры)
-                    target_position = [x/1000.0, y/1000.0, z/1000.0]
-                    
-                    # Вычисляем обратную кинематику
-                    # Используем ориентацию по умолчанию (можно настроить под ваши нужды)
-                    target_orientation = [0, 0, 0]  # [roll, pitch, yaw] в радианах
-                    
-                    # Вычисляем углы суставов через обратную кинематику
-                    joint_angles = self.robot_chain.inverse_kinematics(
-                        target_position=target_position,
-                        target_orientation=target_orientation,
-                        orientation_mode="all"
-                    )
-                    
-                    # Отображаем кинематическую цепочку
-                    self.robot_chain.plot(joint_angles, self.xyz_ax, target=target_position)
-                    
-                    # Добавляем целевую точку
-                    self.xyz_ax.scatter([x/1000], [y/1000], [z/1000], 
-                                    c='red', marker='o', s=100, label='Целевая позиция')
-                    
-                except Exception as e:
-                    logger(f"Error inverse kinematic {e}", queue=q)
-                    # Резервный вариант - просто показать точку
-                    self.xyz_ax.scatter([x], [y], [z], c='r', marker='o', s=100, label='Позиция инструмента')
-            else:
-                # Резервный вариант без кинематики
-                self.xyz_ax.scatter([x], [y], [z], c='r', marker='o', s=100, label='Позиция инструмента')
-            
-            # Настраиваем график
-            self.xyz_ax.set_xlabel('X (м)')
-            self.xyz_ax.set_ylabel('Y (м)')
-            self.xyz_ax.set_zlabel('Z (м)')
-            self.xyz_ax.set_title('Кинематическая цепочка робота')
-            self.xyz_ax.legend()
-            
-            # Устанавливаем разумные пределы
-            padding = 0.5  # 50 см в метрах
-            self.xyz_ax.set_xlim([x/1000 - padding, x/1000 + padding])
-            self.xyz_ax.set_ylim([y/1000 - padding, y/1000 + padding])
-            self.xyz_ax.set_zlim([max(0, z/1000 - padding), z/1000 + padding])
-            
-            self.xyz_canvas.draw()
+        """Обновление графика XYZ"""
+        self.xyz_kinematics_plotter.plot(
+            x=self.controller.current_x,