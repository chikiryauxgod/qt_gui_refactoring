commit 97c4ee23fd9d1dccb4fff2ef990d7334e1018ba1
Author:     lewace37 <lewace37@yandex.ru>
AuthorDate: Wed Jan 21 15:37:13 2026 +0500
Commit:     lewace37 <lewace37@yandex.ru>
CommitDate: Wed Jan 21 15:37:13 2026 +0500

    refacator: add into main

diff --git a/src/application/__init__.py b/src/application/__init__.py
new file mode 100644
index 0000000..e69de29
diff --git a/src/application/xyz_trajectory_executor.py b/src/application/xyz_trajectory_executor.py
new file mode 100644
index 0000000..228cc0d
--- /dev/null
+++ b/src/application/xyz_trajectory_executor.py
@@ -0,0 +1,19 @@
+from typing import Iterable, Tuple
+
+
+class XYZTrajectoryExecutor:
+    def __init__(self, controller, trajectory_service, delay_sec: float = 1.0):
+        self._controller = controller
+        self._trajectory_service = trajectory_service
+        self._delay_sec = delay_sec
+
+    def execute(self) -> None:
+        for x, y, z in self._trajectory_service.get_points():
+            self._controller.set_coord_pos(x, y, z)
+            self._sleep()
+
+    def _sleep(self) -> None:
+        import time
+        time.sleep(self._delay_sec)
+
+
diff --git a/src/ports/__init__.py b/src/ports/__init__.py
new file mode 100644
index 0000000..e69de29
diff --git a/src/ports/robot_controller_port.py b/src/ports/robot_controller_port.py
index 1d1b743..c10cd8b 100644
--- a/src/ports/robot_controller_port.py
+++ b/src/ports/robot_controller_port.py
@@ -2,6 +2,9 @@ from typing import Protocol
 
 
 class RobotControllerPort(Protocol):
+    X0: float
+    Y0: float
+    Z0: float
+
     def move_xyz(self, dx: float, dy: float, dz: float) -> None: ...
     def set_coord_pos(self, x: float, y: float, z: float) -> None: ...
-    def return_to_zero_xyz(self) -> None: ...
diff --git a/src/presenters/__init__.py b/src/presenters/__init__.py
new file mode 100644
index 0000000..e69de29
diff --git a/src/presenters/xyz_control_presenter.py b/src/presenters/xyz_control_presenter.py
index 5a44785..9d42f2b 100644
--- a/src/presenters/xyz_control_presenter.py
+++ b/src/presenters/xyz_control_presenter.py
@@ -14,4 +14,9 @@ class XYZControlPresenter:
         self._controller.set_coord_pos(x, y, z)
 
     def return_to_zero(self) -> None:
-        self._controller.return_to_zero_xyz()
+        self._controller.set_coord_pos(
+            self._controller.X0,
+            self._controller.Y0,
+            self._controller.Z0
+        )
+
diff --git a/src/qt_interface.py b/src/qt_interface.py
index 5a8b13e..97eaa74 100644
--- a/src/qt_interface.py
+++ b/src/qt_interface.py
@@ -31,6 +31,8 @@ from src.widgets.axis_control_widget import AxisControlWidget
 from src.erosionWorker.errosionWorker import ErosionWorker, ErosionController, GCodeProcessor
 from src.services.xyz_trajectory_service import XYZTrajectoryService
 from src.services.joint_trajectory_service import JointTrajectoryService
+from src.presenters.xyz_control_presenter import XYZControlPresenter
+from src.application.xyz_trajectory_executor import XYZTrajectoryExecutor
 
 #+ Передать в electroerosion очередь, она заполняется в port и robot, её нужно просто туда передать
 #+ Выводить содержимое очереди в textbox процесса эрозии
@@ -944,8 +946,12 @@ class ServiceTab(QWidget):
     def __init__(self, controller):
         super().__init__()
         self.controller = controller
+        self.xyz_presenter = XYZControlPresenter(controller)
         self.trajectory_service = XYZTrajectoryService()
         self.trajectory_points_joints = JointTrajectoryService()
+        self.xyz_trajectory_executor = XYZTrajectoryExecutor(
+        controller=self.controller,
+        trajectory_service=self.trajectory_service,)
         self.continuous_move_timer = QTimer()
         self.continuous_move_timer.timeout.connect(self.continuous_move)
         self.continuous_move_data = None
@@ -1670,7 +1676,7 @@ class ServiceTab(QWidget):
         }
         positions[axis] = value
         
-        self.controller.set_coord_pos(positions['X'], positions['Y'], positions['Z'])
+        self.xyz_presenter.set_position(positions['X'], positions['Y'], positions['Z'])
 
     @Slot(str, float)
     def move_xyz(self, axis, step):
@@ -1815,9 +1821,8 @@ class ServiceTab(QWidget):
         z = self.new_z.value()
         
         if self.check_point_availability(x, y, z):
-            self.xyz_trajectory_service.add_point(x, y, z)
-
-            index = len(self.xyz_trajectory_service.get_points())
+            self.trajectory_service.add_point(x, y, z)
+            index = len(self.trajectory_service.get_points())
             self.xyz_listbox.addItem(
                 f"{index}: X: {x:.2f}, Y: {y:.2f}, Z: {z:.2f}"
             )
@@ -1830,11 +1835,11 @@ class ServiceTab(QWidget):
         current_row = self.xyz_listbox.currentRow()
         if current_row >= 0:
             self.xyz_listbox.takeItem(current_row)
-            self.xyz_trajectory_service.remove_point(current_row)
+            self.trajectory_service.remove_point(current_row)
 
             self.xyz_listbox.clear()
             for i, (x, y, z) in enumerate(
-                self.xyz_trajectory_service.get_points()
+                self.trajectory_service.get_points()
             ):
                 self.xyz_listbox.addItem(
                     f"{i + 1}: X: {x:.2f}, Y: {y:.2f}, Z: {z:.2f}"
@@ -1844,26 +1849,23 @@ class ServiceTab(QWidget):
 
     @Slot()
     def clear_xyz_trajectory(self):
-        self.xyz_trajectory_service.clear()
+        self.trajectory_service.clear()
         self.xyz_listbox.clear()
         self.update_xyz_trajectory_plot()
 
 
     @Slot()
     def return_to_zero_xyz(self):
-        self.controller.set_coord_pos(self.controller.X0, self.controller.Y0, self.controller.Z0)
+        self.xyz_presenter.return_to_zero()
 
     @Slot()
     def execute_xyz_trajectory(self):
-        if not self.trajectory_points_xyz:
+        if not self.trajectory_service.get_points():
             QMessageBox.critical(self, "Ошибка", "Траектория не задана")
             return
-        
-        logger('Execution traectory XYZ...', queue=q)
-        for i, point in enumerate(self.trajectory_points_xyz):
-            x, y, z = point
-            self.controller.set_coord_pos(x, y, z)
-            time.sleep(1)  # Задержка для демонстрации
+
+        logger('Execution trajectory XYZ...', queue=q)
+        self.xyz_trajectory_executor.execute()
 
     @Slot()
     def update_xyz_trajectory_plot(self):
@@ -1914,7 +1916,7 @@ class ServiceTab(QWidget):
         
         if self.check_joints_availability(joints):
             self.trajectory_points_joints.add_point(joints)
-            index = len(self.trajectory_points_joints)
+            index = len(self.trajectory_points_joints.get_points())
             self.joints_listbox.addItem(f"{index}: J0: {joints[0]:.2f}, J1: {joints[1]:.2f}, J2: {joints[2]:.2f}")
             self.update_joints_trajectory_plot()
         else:
diff --git a/tests/presenters/test_xyz_control_presenter.py b/tests/ServiceTab/presenters/test_xyz_control_presenter.py
similarity index 83%
rename from tests/presenters/test_xyz_control_presenter.py
rename to tests/ServiceTab/presenters/test_xyz_control_presenter.py
index cb6e8fd..a7d4d2f 100644
--- a/tests/presenters/test_xyz_control_presenter.py
+++ b/tests/ServiceTab/presenters/test_xyz_control_presenter.py
@@ -22,8 +22,13 @@ def test_set_position_calls_controller():
 
 def test_return_to_zero_calls_controller():
     controller = Mock()
+    controller.X0 = 0.0
+    controller.Y0 = 0.0
+    controller.Z0 = 0.0
+
     presenter = XYZControlPresenter(controller)
 
     presenter.return_to_zero()
 
-    controller.return_to_zero_xyz.assert_called_once()
+    controller.set_coord_pos.assert_called_once_with(0.0, 0.0, 0.0)
+
diff --git a/tests/ServiceTab/test_xyz_trajectory_executor.py b/tests/ServiceTab/test_xyz_trajectory_executor.py
new file mode 100644
index 0000000..58161fd
--- /dev/null
+++ b/tests/ServiceTab/test_xyz_trajectory_executor.py
@@ -0,0 +1,24 @@
+from unittest.mock import Mock
+
+from src.application.xyz_trajectory_executor import XYZTrajectoryExecutor
+
+
+def test_xyz_trajectory_execution_calls_controller_in_order():
+    controller = Mock()
+    trajectory_service = Mock()
+    trajectory_service.get_points.return_value = [
+        (1, 2, 3),
+        (4, 5, 6),
+    ]
+
+    executor = XYZTrajectoryExecutor(
+        controller=controller,
+        trajectory_service=trajectory_service,
+        delay_sec=0,
+    )
+
+    executor.execute()
+
+    controller.set_coord_pos.assert_any_call(1, 2, 3)
+    controller.set_coord_pos.assert_any_call(4, 5, 6)
+    assert controller.set_coord_pos.call_count == 2
